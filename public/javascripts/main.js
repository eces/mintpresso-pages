// Generated by CoffeeScript 1.6.3
/*
  Author: Jinhyuk Lee
*/(function(){String.prototype.format===void 0&&(String.prototype.format=function(){var e;e=arguments;return this.replace(/{(\d+)}/g,function(t,n){return typeof e[n]!="undefined"?e[n]:t})});String.prototype.endsWith=function(e){return this.substr(this.length-e.length)===e};String.prototype.startsWith=function(e){return this.substr(0,e.length)===e};jQuery(function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y;$("input, textarea").placeholder();$.extend({getParameters:function(){var e,t,n,r,i,s;n=[];if(window.location.hash.indexOf("?")===-1)return[];s=window.location.hash.slice(window.location.hash.indexOf("?")+1).split("&");for(r=0,i=s.length;r<i;r++){e=s[r];if(e.length===0)continue;t=e.split("=");n.push(t[0]);n[t[0]]=t[1]}return n},getParameter:function(e){var t;t=$.getParameters()[e];return t===void 0?"":t},getParameterHash:function(){return window.location.hash.indexOf("?")===-1?"":window.location.hash.slice(window.location.hash.indexOf("?"))},setParameter:function(e,t){var n,r,i,s,o;if($.getParameter(e)===void 0){window.location.hash.indexOf("?")===-1&&(window.location.hash+="?");window.location.hash+=e+"="+t+"&"}else{r=$.getParameters;i="?";for(s=0,o=r.length;s<o;s++){n=r[s];i+=n+"="+r[n]+"&"}i+=e+"="+t+"&";window.location.hash=window.location.hash.slice(0,window.location.hash.indexOf("?"))+i}return $("#submenu li.active").data("parameter",$.getParameterHash())}});e=$("body");f={afterLoad:function(){var e;e=$("#animation-mask #logo");if(_.doneLoading===!0)if(_.waitForLoading===!0)e.is(":hidden")?e.fadeIn(1e3,"easeInQuint",function(e){return f.afterLoad()}):setTimeout(f.afterLoad,500);else{e.hide();$("#single-page div.modal").animate({marginTop:"15.5px"},1e3,"easeOutQuint");$("#animation-mask").fadeOut({duration:1e3,easing:"easeOutQuint"})}else e.is(":hidden")?e.fadeIn(1e3,"easeInQuint",function(e){return f.afterLoad()}):setTimeout(f.afterLoad,500);return!0}};_.waitForLoading===void 0&&(_.waitForLoading=!1);_.doneLoading===void 0&&(_.doneLoading=!1);_.loadingInterval=180;i=$("meta[name=animation]");if(i.length>0&&i!==void 0){a=i[0].getAttribute("content");if(a==="fadein"){u=$("#single-page").is(".white")?"white":"black";e.append('<div id="animation-mask" class="'+u+'">\n  <div id="logo" class="hide '+u+'"></div>\n</div>');$("#single-page").show();$(window).load(function(e){_.doneLoading=!0;return f.afterLoad()})}}p=function(e){var t;t=e.data("state");t===0&&e.data("state",Math.round(Date.now()/1e3));return e.addClass("active").fadeIn({duration:300,easing:"easeOutQuint"})};h=function(e){return e.find("div.active").fadeOut({duration:300,easing:"easeOutQuint"})};d=function(e,t){e.find("li:not(.reactive)").removeClass("active");t.addClass("active");e.data("parameter")===void 0&&e.data("parameter","");return document.location.hash="!/"+t.data("menu")+$.getParameterHash()};m=function(e,t,n,r){var i,s;i=e.find("[data-content="+n.data("menu")+"]");if(n.is(".active"))return!0;n.is(".reactive")?n.removeClass("reactive"):h(e);i.is(".wide")?e.addClass("wide"):e.removeClass("wide");d(t,n);s=i.data("state");s===0||s<Math.round(Date.now()/1e3)-_.loadingInterval?r(i):p(i);return!0};v=function(e,t,n,r){var i,s;i=e.find("[data-content="+n+"]");i.data("state",0);s=t.find("[data-menu="+n+"]");if(s.length>0){s.removeClass("active");s.addClass("reactive");s.trigger("click");return r(i)}return console.log("Invalid data-menu=? at method refreshContent")};y=function(e,t){var n,r;n=e.find("[data-content=index]");h(e);s.find("li").removeClass("active");r=n.data("state");r===0||r<Math.round(Date.now()/1e3)-_.loadingInterval?t(n):p(n);return!0};g=function(e,t){var n,r,i,s;s=document.location.pathname;$.getParameterHash().length>0?r=window.location.hash.slice(3,window.location.hash.indexOf("?")):r=window.location.hash.slice(3);i=$("#menu li.active").data("menu");if(r===void 0||r.length===0)return y(e,function(e){return routes.controllers.Panel[i+"_index"](_.id).ajax().error(o(e)).success(function(t){e.html(t);return p(e)})});if(s.charAt(s.length-1)==="/"){n=t.find("[data-menu="+r+"]");t.data("data-parameter",$.getParameterHash());if(n.length>0)return n.trigger("click");console.log("Invalid data-menu='"+r+"' at method triggerHash");document.location.hash="!/index"+$.getParameterHash();return y(e,function(e){return routes.controllers.Panel[i+"_index"](_.id).ajax().error(o(e)).success(function(t){e.html(t);return p(e)})})}return!1};o=function(e){return function(t,n,r){e.html("<h1>"+r+'</h1>\n<p>사용자 요청이 많아 일시적으로 응답이 지연되고 있습니다. 이 현상이 지속될 경우 support@mintpresso.com 또는 트위터로 연락바랍니다.</p>\n<div class="toolbar" style="height:220px">\n  <a class="twitter-timeline" href="https://twitter.com/mintpresso" data-widget-id="310993678212665344">@mintpresso 님의 트윗</a>\n  <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>\n</div>');return p(e)}};l=function(e){return function(t,n,r){var i;$("form span.help-block").html('<span class="label label-inverse">'+r+"</span> "+"사용자 요청이 많아 일시적으로 응답이 지연되고 있습니다. 이 현상이 지속될 경우 support@mintpresso.com 또는 트위터로 연락바랍니다.");i=e.find("div.toolbar");if(i.length===0)e.append('<div class="toolbar" style="height:220px">\n  <a class="twitter-timeline" href="https://twitter.com/mintpresso" data-widget-id="310993678212665344">@mintpresso 님의 트윗</a>\n  <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>\n</div>');else{i.html('<a class="twitter-timeline" href="https://twitter.com/mintpresso" data-widget-id="310993678212665344">@mintpresso 님의 트윗</a>\n<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>');i.height("220px")}return p(e)}};i=$("meta[name=panel]");if(i.length>0&&i!==void 0){_.page=i[0].getAttribute("content");if(_.page==="overview"){s=$("#submenu");n=$("#content");s.find("[data-menu=usage]").click(function(e){return m(n,s,$(this),function(e){return routes.controllers.Panel.overview_usage(_.id).ajax().error(o(e)).success(function(t){e.html(t);return p(e)})})});s.find("[data-menu=account]").click(function(e){return m(n,s,$(this),function(e){return routes.controllers.Panel.overview_account(_.id).ajax().error(o(e)).success(function(t){e.html(t);return p(e)})})});s.find("[data-menu=transaction]").click(function(e){return m(n,s,$(this),function(e){return routes.controllers.Panel.overview_transaction(_.id).ajax().error(o(e)).success(function(t){e.html(t);return p(e)})})});s.find("[data-menu=api]").click(function(e){return m(n,s,$(this),function(e){return routes.controllers.Panel.overview_api(_.id).ajax().error(o(e)).success(function(t){var r,i;e.html(t);r=e.find("table#tokens tbody");i=_._api;r.prepend('<tr>\n  <td>\n    <input name="key" type="text" value="'+i.identifier+'" disabled="disabled" class="editable code" style="width:450px; font-size:8pt" />\n    <br />\n    <textarea name="domain" title="Accessible Domains" class="editable" style="width:437px">'+i.data.url.split("|").join("\n")+'</textarea>\n  </td>\n  <td>\n    <input name="name" type="text" value="'+i.data.name+'" class="editable" />\n    <div class="btn-group">\n      <button type="submit" class="btn" style="width: 190px">SAVE</button>\n      <button class="btn dropdown-toggle" data-toggle="dropdown" style="width: 45px">\n        <span class="caret"></span>\n      </button>\n      <ul class="dropdown-menu" style="width: 230px">\n        <li><a href="#" class="api-js">JavaScript API</a></li>\n        <li><a href="#" class="api-scala">Scala API</a></li>\n      </ul>\n    </div>\n  </td>\n</tr>');r.find("span.seal").click(function(){return $(this).toggleClass("seal")});r.find("tr").first().find("td div.btn-group button.dropdown-toggle").tooltip({title:"API KEY가 들어간 소스코드를 받을 수 있습니다."});r.find("ul.dropdown-menu a").click(function(e){var t,n,r;t=$(this);r=t.closest("tr").find("input[name=key]").val();n=_.id;if(t.is(".api-js"))return alert('Add it into <head> ... </head>\n\n<script type="text/javascript">\n(function(e,t,k,o){var n,r,i;r=e.createElement("script");\nr.type="text/javascript";r.async=!0;\nr.onload=function(){if(\'mintpresso\' in window){return window["mintpresso"].init(t,k,o);}else{console.error(\'Failed to load mintpresso.js (please check http://mintpresso.statuspage.io)\')}};\ni="//mintpresso.com/assets/javascript-api/mintpresso-0.2.js";\nif("https:"===e.location.protocol){r.src="https:"+i}else{r.src="http:"+i}n=e.getElementsByTagName("script")[0];return n.parentNode.insertBefore(r,n)}\n)(document,"'+r+'",'+n+", {withoutCallback: false, useLocalhost: false, callbackFunction: 'mintpressoInit', disableDebugCallback: true})\n</script>");if(t.is(".api-scala"))return alert('Copy and paste block you need from these 3 examples.\n\n// for application.conf\nmintpresso.api="'+r+'"\nmintpresso.id='+n+'\n\n// inline Affogato\nval mintpresso: Affogato = Affogato("'+r+'", '+n+')\n\n// Affogato with Play Framework\nval mintpresso: Affogato = Affogato( \n  Play.configuration.getString("mintpresso.api").getOrElse("'+r+'"),\n  Play.configuration.getLong("mintpresso.id").getOrElse('+n+"L)\n)\n")});e.find("form#domain").find("tr button[type=submit]").each(function(t,r){var i;i=$(r);return i.click(function(t){var r,i;if($(this).attr("data-type")==="new"){alert("현재 인증키는 하나만 발급가능합니다.");return!1}r=$(this).closest("tr");h(n);i={success:function(e){return v(n,s,"api",function(e){return!0})},error:o(e)};routes.controllers.Panel.overview_api_set(_.id,r.find("input[name=key]").val(),r.find("textarea[name=domain]").val(),r.find("input[name=name]").val()).ajax(i);t.preventDefault();t.stopPropagation();return!1})});return p(e)})})});g(n,s);_.waitForLoading=!1}else if(_.page==="data"){s=$("#submenu");n=$("#content");s.find("[data-menu=log]").click(function(e){return m(n,s,$(this),function(e){return routes.controllers.Panel.data_log(_.id).ajax().error(o(e)).success(function(t){var n,r,i,s,o,u,a,f,l,c,h,d,v,m,g,y,b,w,E;e.html(t);_._recents=0;if(_._errors!==void 0&&_._errors._length>0){r=e.find("table#logs");b=_._errors.edges;for(h=0,m=b.length;h<m;h++){t=b[h];s=moment(t.createdAt).format("YYYY-MM-DD HH:mm:ss");o=moment(t.createdAt).fromNow();u=t.object.data;a=u.message;delete u.message;u=t.object.data;delete u.message;i=js_beautify(JSON.stringify(u),{indent_size:2});f="";if(Date.now()<t.createdAt+36e5){f="recents error";_._recents++}r.append('<tr class="errors '+f+'">\n  <td><i class="icon-frown"></i> '+a+'</td>\n  <td><button class="btn btn-mini" data-trigger="json">Show details</button></td>\n  <td>\n    <time datetime="'+s+'" title="'+s+'">'+o+'</time>\n  </td>\n</tr>\n<tr class="hide editor">\n  <td colspan="5">\n    <textarea class="code">'+i+"</textarea>\n  </td>\n</tr>")}}if(_._warnings!==void 0&&_._warnings._length>0){r=e.find("table#logs");w=_._warnings.edges;for(d=0,g=w.length;d<g;d++){t=w[d];s=moment(t.createdAt).format("YYYY-MM-DD HH:mm:ss");o=moment(t.createdAt).fromNow();u=t.object.data;a=u.message;delete u.message;i=js_beautify(JSON.stringify(u),{indent_size:2});f="";if(Date.now()<t.createdAt+36e5){f="recents warning";_._recents++}r.append('<tr class="warnings '+f+'">\n  <td><i class="icon-meh"></i> '+a+'</td>\n  <td><button class="btn btn-mini" data-trigger="json">Show details</button></td>\n  <td>\n    <time datetime="'+s+'" title="'+s+'">'+o+'</time>\n  </td>\n</tr>\n<tr class="hide editor">\n  <td colspan="5">\n    <textarea class="code">'+i+"</textarea>\n  </td>\n</tr>")}}if(_._requests!==void 0&&_._requests._length>0){r=e.find("table#logs");E=_._requests.edges;for(v=0,y=E.length;v<y;v++){t=E[v];s=moment(t.createdAt).format("YYYY-MM-DD HH:mm:ss");o=moment(t.createdAt).fromNow();u=t.object.data;a=u.message;delete u.message;u=t.object.data;delete u.message;i=js_beautify(JSON.stringify(u),{indent_size:2});f="";if(Date.now()<t.createdAt+36e5){f="recents success";_._recents++}r.append('<tr class="requests '+f+'">\n  <td><i class="icon-smile"></i> '+a+'</td>\n  <td><button class="btn btn-mini" data-trigger="json">Show details</button></td>\n  <td>\n    <time datetime="'+s+'" title="'+s+'">'+o+'</time>\n  </td>\n</tr>\n<tr class="hide editor">\n  <td colspan="5">\n    <textarea class="code">'+i+"</textarea>\n  </td>\n</tr>")}}if(_._errors!==void 0&&_._warnings!==void 0&&_._requests!==void 0&&_._errors._length+_._warnings._length+_._requests._length===0)$('<div class="status-popup">\n<br />\n<br />\n<br />\n<i class="icon-rotate-right icon-spin" style="font-size:100pt; color: #1ABC9C"></i>\n<br />\n<h1 style="font-weight: 900">WE\'RE RECEIVING DATA !</h1>\n</div>').insertAfter(e.find("#selector"));else{e.find("button[data-trigger=json]").click(function(e){var t,n,r;n=$(this);r=n.closest("tr").next();t=r.find("textarea");r.toggle();if(!t.is(".scaled"))return t.height(t[0].scrollHeight)});e.find("#selector div.btn-group button").each(function(e,t){var n;n=$(t);switch(n.data("field")){case"recent":if(_._recents>0)return n.html('{0} <span class="typo-number label-number">{1}</span>'.format(n.html(),_._recents));break;case"error":if(_._errors._length>0)return n.html('{0} <span class="typo-number label-number">{1}</span>'.format(n.html(),_._errors._length));break;case"warning":if(_._warnings._length>0)return n.html('{0} <span class="typo-number label-number">{1}</span>'.format(n.html(),_._warnings._length));break;case"request":if(_._requests._length>0)return n.html('{0} <span class="typo-number label-number">{1}</span>'.format(n.html(),_._requests._length))}});l=function(e){r.find("tbody tr").hide();return r.find("tbody tr."+e+":not(.editor)").show()};n=e.find("#no-recents");c=function(){l("recents");if(_._recents===0)return n.show()};e.find("#selector div.btn-group button").click(function(e){var t;t=$(this);n.hide();switch(t.data("field")){case"recent":return c();case"error":return l("errors");case"warning":return l("warnings");case"request":return l("requests")}});c();r.fadeIn()}return p(e)})})});s.find("[data-menu=view]").click(function(e){return m(n,s,$(this),function(e){return routes.controllers.Panel.data_view(_.id,$.getParameter("_filter")).ajax().error(o(e)).success(function(t){var r,i,o,u,a,f,l,c,d,m,g,y,b,w,E,S,x,T,N;e.html(t);e.find("input[name=s]").typeahead({source:_._types});e.find("input[name=o]").typeahead({source:_._types});e.find("#selector div.custom-filter a.add").tooltip({title:"Add new filter"});u=e.find("#revert");$.getParameter("_filter").length>0?u.click(function(){$.setParameter("_filter","");return v(n,s,"view",function(e){return!0})}):u[0].disabled="disabled";i=e.find("#refresh");i.click(function(){return v(n,s,"view",function(e){return!0})});if(_._points!==void 0&&_._points.points.length>0){a=e.find("table#points");T=_._points.points;for(w=0,S=T.length;w<S;w++){y=T[w];l=moment(y.createdAt).format("YYYY-MM-DD HH:mm:ss");c=moment(y.createdAt).fromNow();f=js_beautify(JSON.stringify(y.data),{indent_size:2});d=Object.keys(y.data).length;d>0?m=d+" keys":m="Empty";f==="{}"&&(f="/* no data json */");a.prepend('<tr>\n  <td><a href="'+y._url+'">'+y.id+"</a></td>\n  <td>"+y.type+"</td>\n  <td>"+y.identifier+'</td>\n  <td><button class="btn" data-trigger="json">'+m+'</button></td>\n  <td>\n    <time datetime="'+l+'" title="'+l+'">'+c+'</time>\n  </td>\n</tr>\n<tr class="hide editor">\n  <td colspan="5">\n    <textarea class="code">'+f+"</textarea>\n  </td>\n</tr>")}a.fadeIn()}else if(_._edges!==void 0&&_._edges.edges.length>0){a=e.find("table#edges");N=_._edges.edges;for(E=0,x=N.length;E<x;E++){t=N[E];l=moment(t.createdAt).format("YYYY-MM-DD HH:mm:ss");c=moment(t.createdAt).fromNow();b=js_beautify(JSON.stringify(t.subject),{indent_size:2});g=js_beautify(JSON.stringify(t.object),{indent_size:2});f="/* no data json */";a.prepend('<tr>\n  <td>\n    <button class="btn btn-small" data-trigger="json" data-type="subject">'+t.subjectType+'</button>\n    <button class="btn btn-small btn-primary" data-trigger="fill" data-type="subjectId">'+t.subjectId+"</button>\n  </td>\n  <td>"+t.verb+'</td>\n  <td>\n    <button class="btn btn-small" data-trigger="json" data-type="object">'+t.objectType+'</button>\n    <button class="btn btn-small btn-primary" data-trigger="fill" data-type="objectId">'+t.objectId+'</button>\n  </td>\n  <td class="code">'+f+'</td>\n  <td>\n    <time datetime="'+l+'" title="'+l+'">'+c+'</time>\n  </td>\n</tr>\n<tr class="hide editor">\n  <td colspan="2">\n    <textarea class="code subject">'+b+'</textarea>\n  </td>\n  <td colspan="3">\n    <textarea class="code object">'+g+"</textarea>\n  </td>\n</tr>")}a.fadeIn()}e.find("button[data-trigger=json]").click(function(e){var t,n,r;n=$(this);r=n.closest("tr").next();if(n.data("type")==="subject"){t=r.find("textarea");r.toggle();if(!t.is(".scaled"))return t.height(Math.max(t[0].scrollHeight,t[1].scrollHeight))}else{t=r.find("textarea");r.toggle();if(!t.is(".scaled"))return t.height(t[0].scrollHeight)}});e.find("button[data-trigger=fill]").click(function(e){var t,n;n=$(this);t=$("form#model");if(n.data("type")==="subjectId")return t.find("input[name=s]").val(n.html());if(n.data("type")==="objectId")return t.find("input[name=o]").val(n.html())});r=e.find("form#model");r.submit(function(){var t;h(n);e.find("table").hide();delete _._points;delete _._edges;t={s:r.find("input[name=s]").val(),v:r.find("input[name=v]").val(),o:r.find("input[name=o]").val()};$.setParameter("_filter",JSON.stringify(t));return v(n,s,"view",function(e){return!0})});o=e.find("form#relation");return p(e)})})});s.find("[data-menu=filter]").click(function(e){return m(n,s,$(this),function(e){return routes.controllers.Panel.data_filter(_.id).ajax().error(o(e)).success(function(t){e.html(t);return p(e)})})});s.find("[data-menu=import]").click(function(e){return m(n,s,$(this),function(e){return routes.controllers.Panel.data_import(_.id).ajax().error(o(e)).success(function(t){var r;e.html(t);p(e);e.find("input[name=model]").typeahead({source:_._sTypes});r=e.find("form#model");r.submit(function(){var t,i;t={data:{model:r.find("input[name=model]").val(),identifier:r.find("input[name=identifier]").val(),data:r.find("textarea[name=data]").val()},success:function(e){return v(n,s,"import",function(e){return!0})},error:l(e)};try{t.data.data.length>0&&JSON.parse(t.data.data)}catch(o){i=o;r.find("span.help-block").html("JSON 데이터가 유효하지 않습니다: "+i.toString());return!1}h(n);routes.controllers.Panel.data_import_add(_.id).ajax(t);return!1});return e.find("time").each(function(e,t){var n;n=$(t);return n.html(moment(n.html()).fromNow())})})})});s.find("[data-menu=export]").click(function(e){return m(n,s,$(this),function(e){return routes.controllers.Panel.data_export(_.id).ajax().error(o(e)).success(function(t){e.html(t);return p(e)})})});g(n,s);_.waitForLoading=!1;_.triggerContentWith=function(e,t){return m(n,s,$(this),function(n){return routes.controllers.Panel["data_"+e](_.id,JSON.stringify(t)).ajax().error(o(n)).success(function(e){n.html(e);return p(n)})})}}else if(_.page==="support"){s=$("#submenu");n=$("#content");s.find("[data-menu=conversation]").click(function(e){return m(n,s,$(this),function(e){return routes.controllers.Panel.support_conversation(_.id).ajax().error(o(e)).success(function(t){e.html(t);return p(e)})})});s.find("[data-menu=consulting]").click(function(e){return m(n,s,$(this),function(e){return routes.controllers.Panel.support_consulting(_.id).ajax().error(o(e)).success(function(t){e.html(t);return p(e)})})});g(n,s);_.waitForLoading=!1}else if(_.page==="order"){s=$("#submenu");n=$("#content");g(n,s);_.waitForLoading=!1}else if(_.page==="pickup"){s=$("#submenu");n=$("#content");g(n,s);_.waitForLoading=!1}else alert("페이지를 불러올 수 없습니다. ")}i=$("meta[name=document]");if(i.length>0&&i!==void 0){_.page=i[0].getAttribute("content");e=$("#document #body");e.find("time.updatedAt").each(function(e,t){var n;n=$(t);return n.html(moment(n.html(),"YYYY-MM-DD").fromNow())});if(_.page==="javascript/api"){t=$("div#body textarea.code");t.val(t.val().replace("YOUR API KEY HERE",_._api.token+"::"+_.id))}}i=$("meta[name=login]");if(i.length>0&&i!==void 0){_.page=i[0].getAttribute("content");if(_.page==="changeAccount"){r=$("#link");c=r.html()+location.hash;r.html(c);return r[0].href=c}}})}).call(this);